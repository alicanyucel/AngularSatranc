import { Component, ContentChildren, EventEmitter, HostListener, Input, Output, ViewChild, ViewEncapsulation, forwardRef, signal } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { FlexiOptionComponent } from './flexi-option.component';
import { CommonModule } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class FlexiSelectComponent {
    constructor() {
        this.data = [];
        this.noData = "Kayıt bulunamadı";
        this.selectOne = "Seçim yapınız";
        this.themeClass = "light";
        this.itemsPerPage = 30;
        this.clientHeight = 180;
        this.multiple = false;
        this.closeAfterSelect = true;
        this.height = "100%";
        this.selected = new EventEmitter();
        this.onChange = (value) => { };
        this.onTouched = () => { };
        this.filteredData = signal([]);
        this.selectedItem = signal({});
        this.selectedItems = signal([]);
        this.isOpen = signal(false);
    }
    ngOnChanges(changes) {
        this.filteredData.set(this.data.slice(0, this.itemsPerPage));
        this.selectFirstOne();
        this.selectInitialStateValue();
    }
    ngAfterContentInit() {
        this.options.changes.subscribe(() => {
            if (this.options && this.options.length) {
                const optionData = this.options.map(option => ({
                    value: option.value,
                    label: option.viewValue
                }));
                this.data = optionData;
                this.filteredData.set(this.data.slice(0, this.itemsPerPage));
                this.selectFirstOne();
                this.label = "label";
                this.value = "value";
                this.selectInitialStateValue();
            }
        });
    }
    selectInitialStateValue() {
        if (this.data.length > 0 && this.initialState) {
            if (this.multiple) {
                this.clearAllSelected();
                this.selectedItems.set([]);
                const list = [];
                for (const val of this.initialState) {
                    const d = this.data.find(p => p[this.value] === val);
                    d.isSelected = true;
                    const item = {
                        [this.label]: d[this.label],
                        [this.value]: val
                    };
                    list.push(item);
                }
                this.selectedItems.set(list);
                this.initialState = undefined;
            }
            else {
                const val = this.data.find(p => p[this.value] === this.initialState);
                if (val) {
                    this.clearAllSelected();
                    this.selectedItem.set({ [this.label]: val[this.label], [this.value]: val[this.value] });
                    val.isSelected = true;
                    const findValue = this.filteredData().find(p => p[this.value] === val);
                    this.initialState = undefined;
                    if (findValue) {
                        findValue.isSelected = true;
                    }
                }
            }
        }
    }
    loadMoreData() {
        const val = this.flexiSelectInput.nativeElement.value.toString().toLocaleLowerCase("tr");
        let newData = val === "" ? this.data : this.data.filter(p => p[this.label].toString().toLocaleLowerCase("tr").includes(val));
        newData = newData.slice((this.filteredData().length - 1), (this.filteredData().length + this.itemsPerPage));
        this.filteredData.set([...this.filteredData(), ...newData]);
        this.clientHeight = this.clientHeight + 180;
    }
    onScroll(event) {
        const element = event.target;
        if (element.scrollHeight - element.scrollTop < 200) {
            this.loadMoreData();
        }
    }
    clearAllSelected() {
        this.filteredData().forEach(val => {
            val.isSelected = false;
        });
    }
    selectFirstOne() {
        if (this.filteredData().length === 0) {
            return;
        }
        this.clearAllSelected();
        this.filteredData()[0].isSelected = true;
    }
    openOrClose() {
        this.isOpen.set(!this.isOpen());
        if (this.isOpen()) {
            setTimeout(() => {
                this.flexiSelectInput?.nativeElement.focus();
            }, 100);
        }
    }
    handleClick(event) {
        const target = event.target;
        if (!target.closest('.flexi-select')) {
            this.isOpen.set(false);
        }
    }
    search() {
        const val = this.flexiSelectInput.nativeElement.value.toString().toLocaleLowerCase("tr");
        const filtered = this.data.filter(p => p[this.label].toString().toLocaleLowerCase("tr").includes(val)).slice(0, this.itemsPerPage);
        this.filteredData.set(filtered);
        if (!this.multiple) {
            this.selectFirstOne();
        }
    }
    setLiClass(item) {
        if (item.isSelected) {
            return "flexi-select-li flexi-active";
        }
        return "flexi-select-li";
    }
    onKeyDown(event) {
        const currentIndex = this.filteredData().findIndex(item => item.isSelected);
        if (event.key === 'Enter') {
            event.preventDefault();
            if (currentIndex !== -1) {
                this.select(this.filteredData()[currentIndex]);
            }
        }
        else if (event.key === 'ArrowDown') {
            event.preventDefault();
            if (currentIndex < this.filteredData().length - 1) {
                this.clearAllSelected();
                this.filteredData()[currentIndex + 1].isSelected = true;
                this.scrollToElement(currentIndex + 1);
            }
        }
        else if (event.key === 'ArrowUp') {
            event.preventDefault();
            if (currentIndex > 0) {
                this.clearAllSelected();
                this.filteredData()[currentIndex - 1].isSelected = true;
                this.scrollToElement(currentIndex - 1);
            }
        }
    }
    scrollToElement(index) {
        const ulElement = document.querySelector('.flexi-select-ul');
        const liElement = ulElement.children[index];
        liElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    selectForMultiple(item) {
        const selectedItem = {
            [this.label]: item[this.label],
            [this.value]: item[this.value]
        };
        if (this.selectedItems().length === 0) {
            this.clearAllSelected();
        }
        const existingIndex = this.selectedItems().findIndex(existingItem => existingItem[this.value] === selectedItem[this.value]);
        if (existingIndex > -1) {
            item.isSelected = false;
            this.selectedItems.update(prev => {
                const updatedItems = [...prev];
                updatedItems.splice(existingIndex, 1);
                return updatedItems;
            });
        }
        else {
            item.isSelected = true;
            this.selectedItems.update(prev => [...prev, selectedItem]);
        }
        if (this.closeAfterSelect) {
            this.isOpen.set(false);
        }
        const selectedItemsForNgModel = this.selectedItems().map(val => val[this.value]);
        this.selected.emit(selectedItemsForNgModel);
        this.onChange(selectedItemsForNgModel);
        this.flexiSelectInput.nativeElement.select();
    }
    selectSingle(item) {
        this.clearAllSelected();
        item.isSelected = true;
        this.selectedItem.set(item);
        if (this.closeAfterSelect) {
            this.isOpen.set(false);
        }
        this.selected.emit(item[this.value]);
        this.onChange(item[this.value]);
        this.flexiSelectInput.nativeElement.select();
    }
    select(item) {
        if (this.multiple) {
            this.selectForMultiple(item);
        }
        else {
            this.selectSingle(item);
        }
    }
    selectOption(option) {
        const selectedItem = {
            [this.value]: option.value,
            [this.label]: option.viewValue
        };
        this.select(selectedItem);
    }
    writeValue(value) {
        if (value) {
            this.initialState = value;
            this.selectInitialStateValue();
        }
        else {
            this.selectedItem.set({});
            this.selectFirstOne();
        }
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        // Implement if needed
    }
    removeSelectedItemFromSelectedItems(index, item) {
        this.selectedItems.update(prev => {
            const updatedItems = [...prev];
            updatedItems.splice(index, 1);
            return updatedItems;
        });
        const existingItem = this.data.find(p => p[this.value] === item[this.value]);
        if (existingItem) {
            existingItem.isSelected = false;
        }
        const selectedItemsForNgModel = this.selectedItems().map(val => val[this.value]);
        this.selected.emit(selectedItemsForNgModel);
        this.onChange(selectedItemsForNgModel);
        this.isOpen.set(true);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: FlexiSelectComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.0.6", type: FlexiSelectComponent, isStandalone: true, selector: "flexi-select", inputs: { data: "data", value: "value", label: "label", noData: "noData", selectOne: "selectOne", themeClass: "themeClass", itemsPerPage: "itemsPerPage", clientHeight: "clientHeight", multiple: "multiple", closeAfterSelect: "closeAfterSelect", height: "height" }, outputs: { selected: "selected" }, host: { listeners: { "document:click": "handleClick($event)" } }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => FlexiSelectComponent),
                multi: true
            }
        ], queries: [{ propertyName: "options", predicate: i0.forwardRef(() => FlexiOptionComponent) }], viewQueries: [{ propertyName: "flexiSelectInput", first: true, predicate: ["flexiSelectInput"], descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div class=\"flexi-select\" [attr.data-bs-theme]=\"themeClass\">\r\n    <div class=\"flexi-select-div\" (click)=\"openOrClose()\" [ngStyle]=\"{'height': height}\">\r\n        @if(!multiple){\r\n            <span>\r\n                {{selectedItem()[label] === undefined ? selectOne : selectedItem()[label]}}\r\n            </span>\r\n        }@else {\r\n            <div class=\"flexi-select-multiple-container\">\r\n                @for(item of selectedItems();track item){\r\n                    <div class=\"flexi-select-multiple-value\">\r\n                        <span aria-hidden=\"true\" class=\"flexi-select-multiple-value-icon-left\" (click)=\"removeSelectedItemFromSelectedItems($index, item)\">\u00D7</span>\r\n                        <span class=\"flexi-select-multiple-value-label\">{{item[label]}}</span>\r\n                    </div>\r\n                }            \r\n            </div>\r\n        }\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\" class=\"flexi-select-div-svg\">\r\n            <path\r\n                d=\"M182.6 470.6c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-9.2-9.2-11.9-22.9-6.9-34.9s16.6-19.8 29.6-19.8H288c12.9 0 24.6 7.8 29.6 19.8s2.2 25.7-6.9 34.9l-128 128z\" />\r\n        </svg>\r\n    </div>\r\n    <div class=\"flexi-select-dropdown\" [hidden]=\"!isOpen()\">\r\n        <input #flexiSelectInput class=\"flexi-select-search-input\" (input)=\"search()\" (keydown)=\"onKeyDown($event)\"\r\n            type=\"search\">\r\n        <ul class=\"flexi-select-ul\" (scroll)=\"onScroll($event)\">\r\n            @for(item of filteredData(); track $index){                \r\n                <li (click)=\"select(item)\" [class]=\"setLiClass(item)\">\r\n                    <span>{{item[label]}}</span>\r\n                </li>\r\n            }\r\n            @empty {\r\n            <li>\r\n                <span>{{noData}}</span>\r\n            </li>\r\n            }\r\n        </ul>\r\n    </div>\r\n</div>", styles: ["[data-bs-theme=light]{--flexi-select-background-color: #fff;--flexi-select-text-color: #000;--flexi-select-active-text-color: #212529;--flexi-select-active-background-color: #ebf5ff;--flexi-select-border-color: #dee2e6;--flexi-select-input-border-color: #dee2e6;--flexi-success: #47D764;--flexi-select: #ebf5ff;--flexi-select-multiple-value-text: #212529}[data-bs-theme=dark]{--flexi-select-background-color: #212529;--flexi-select-text-color: #fff;--flexi-select-active-text-color: #141414;--flexi-select-active-background-color: #f8f9fa;--flexi-select-border-color: #141414;--flexi-select-input-border-color: #f8f9fa;--flexi-success: #47D764;--flexi-select: #ebf5ff;--flexi-select-multiple-value-text: #212529}.flexi-select{position:relative;margin:0!important;padding:0!important}.flexi-select-div{min-height:36px}.flexi-select-div{position:relative;overflow-x:hidden}.flexi-select-div-svg{position:absolute;top:6px;right:10px;fill:var(--flexi-select-text-color);width:10px}.flexi-select-search-input:focus{outline:none}.flexi-select-search-input,.flexi-select-div{display:flex;align-items:center;width:100%;height:calc(1.47em + 1.3rem + 2px);padding:.5rem .875rem;font-size:.8125rem;font-weight:400;line-height:1.47;color:var(--flexi-select-text-color);background-color:var(--flexi-select-background-color);background-clip:padding-box;border:1px solid var(--flexi-select-border-color);border-radius:4px;-webkit-transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out}.flexi-active{font-weight:700}.flexi-active,.flexi-select-li:hover{background-color:var(--flexi-select-active-background-color);color:var(--flexi-select-active-text-color)}.flexi-select-search-input{border-color:var(--flexi-select-input-border-color)}.flexi-select-dropdown{position:absolute;z-index:999;background-color:var(--flexi-select-background-color);color:var(--flexi-select-text-color);width:100%;border:1px solid var(--flexi-select-border-color);border-radius:5px;padding-top:10px;padding-left:5px;padding-right:5px}.flexi-select-ul{height:100%;max-height:180px!important;overflow-y:auto;list-style:none;padding:5px 5px 0}.flexi-select-li{padding:5px;cursor:pointer}.no-click{pointer-events:none}.flexi-select-multiple-container{display:flex;flex-wrap:wrap;gap:5px}.flexi-select-multiple-value{background-color:var(--flexi-select);color:var(--flexi-select-multiple-value-text);padding:2px 3px;display:flex;gap:3px}.flexi-select-multiple-value-label{border-left:1px solid var(--flexi-select-border-color);padding-left:3px}.flexi-select-multiple-value-icon-left{cursor:pointer}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }], encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: FlexiSelectComponent, decorators: [{
            type: Component,
            args: [{ selector: 'flexi-select', standalone: true, imports: [CommonModule], encapsulation: ViewEncapsulation.None, providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => FlexiSelectComponent),
                            multi: true
                        }
                    ], template: "<div class=\"flexi-select\" [attr.data-bs-theme]=\"themeClass\">\r\n    <div class=\"flexi-select-div\" (click)=\"openOrClose()\" [ngStyle]=\"{'height': height}\">\r\n        @if(!multiple){\r\n            <span>\r\n                {{selectedItem()[label] === undefined ? selectOne : selectedItem()[label]}}\r\n            </span>\r\n        }@else {\r\n            <div class=\"flexi-select-multiple-container\">\r\n                @for(item of selectedItems();track item){\r\n                    <div class=\"flexi-select-multiple-value\">\r\n                        <span aria-hidden=\"true\" class=\"flexi-select-multiple-value-icon-left\" (click)=\"removeSelectedItemFromSelectedItems($index, item)\">\u00D7</span>\r\n                        <span class=\"flexi-select-multiple-value-label\">{{item[label]}}</span>\r\n                    </div>\r\n                }            \r\n            </div>\r\n        }\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\" class=\"flexi-select-div-svg\">\r\n            <path\r\n                d=\"M182.6 470.6c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-9.2-9.2-11.9-22.9-6.9-34.9s16.6-19.8 29.6-19.8H288c12.9 0 24.6 7.8 29.6 19.8s2.2 25.7-6.9 34.9l-128 128z\" />\r\n        </svg>\r\n    </div>\r\n    <div class=\"flexi-select-dropdown\" [hidden]=\"!isOpen()\">\r\n        <input #flexiSelectInput class=\"flexi-select-search-input\" (input)=\"search()\" (keydown)=\"onKeyDown($event)\"\r\n            type=\"search\">\r\n        <ul class=\"flexi-select-ul\" (scroll)=\"onScroll($event)\">\r\n            @for(item of filteredData(); track $index){                \r\n                <li (click)=\"select(item)\" [class]=\"setLiClass(item)\">\r\n                    <span>{{item[label]}}</span>\r\n                </li>\r\n            }\r\n            @empty {\r\n            <li>\r\n                <span>{{noData}}</span>\r\n            </li>\r\n            }\r\n        </ul>\r\n    </div>\r\n</div>", styles: ["[data-bs-theme=light]{--flexi-select-background-color: #fff;--flexi-select-text-color: #000;--flexi-select-active-text-color: #212529;--flexi-select-active-background-color: #ebf5ff;--flexi-select-border-color: #dee2e6;--flexi-select-input-border-color: #dee2e6;--flexi-success: #47D764;--flexi-select: #ebf5ff;--flexi-select-multiple-value-text: #212529}[data-bs-theme=dark]{--flexi-select-background-color: #212529;--flexi-select-text-color: #fff;--flexi-select-active-text-color: #141414;--flexi-select-active-background-color: #f8f9fa;--flexi-select-border-color: #141414;--flexi-select-input-border-color: #f8f9fa;--flexi-success: #47D764;--flexi-select: #ebf5ff;--flexi-select-multiple-value-text: #212529}.flexi-select{position:relative;margin:0!important;padding:0!important}.flexi-select-div{min-height:36px}.flexi-select-div{position:relative;overflow-x:hidden}.flexi-select-div-svg{position:absolute;top:6px;right:10px;fill:var(--flexi-select-text-color);width:10px}.flexi-select-search-input:focus{outline:none}.flexi-select-search-input,.flexi-select-div{display:flex;align-items:center;width:100%;height:calc(1.47em + 1.3rem + 2px);padding:.5rem .875rem;font-size:.8125rem;font-weight:400;line-height:1.47;color:var(--flexi-select-text-color);background-color:var(--flexi-select-background-color);background-clip:padding-box;border:1px solid var(--flexi-select-border-color);border-radius:4px;-webkit-transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out}.flexi-active{font-weight:700}.flexi-active,.flexi-select-li:hover{background-color:var(--flexi-select-active-background-color);color:var(--flexi-select-active-text-color)}.flexi-select-search-input{border-color:var(--flexi-select-input-border-color)}.flexi-select-dropdown{position:absolute;z-index:999;background-color:var(--flexi-select-background-color);color:var(--flexi-select-text-color);width:100%;border:1px solid var(--flexi-select-border-color);border-radius:5px;padding-top:10px;padding-left:5px;padding-right:5px}.flexi-select-ul{height:100%;max-height:180px!important;overflow-y:auto;list-style:none;padding:5px 5px 0}.flexi-select-li{padding:5px;cursor:pointer}.no-click{pointer-events:none}.flexi-select-multiple-container{display:flex;flex-wrap:wrap;gap:5px}.flexi-select-multiple-value{background-color:var(--flexi-select);color:var(--flexi-select-multiple-value-text);padding:2px 3px;display:flex;gap:3px}.flexi-select-multiple-value-label{border-left:1px solid var(--flexi-select-border-color);padding-left:3px}.flexi-select-multiple-value-icon-left{cursor:pointer}\n"] }]
        }], propDecorators: { data: [{
                type: Input
            }], value: [{
                type: Input
            }], label: [{
                type: Input
            }], noData: [{
                type: Input
            }], selectOne: [{
                type: Input
            }], themeClass: [{
                type: Input
            }], itemsPerPage: [{
                type: Input
            }], clientHeight: [{
                type: Input
            }], multiple: [{
                type: Input
            }], closeAfterSelect: [{
                type: Input
            }], height: [{
                type: Input
            }], selected: [{
                type: Output,
                args: ["selected"]
            }], options: [{
                type: ContentChildren,
                args: [forwardRef(() => FlexiOptionComponent)]
            }], flexiSelectInput: [{
                type: ViewChild,
                args: ["flexiSelectInput"]
            }], handleClick: [{
                type: HostListener,
                args: ['document:click', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGktc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2ZsZXhpLXNlbGVjdC9zcmMvbGliL2ZsZXhpLXNlbGVjdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9mbGV4aS1zZWxlY3Qvc3JjL2xpYi9mbGV4aS1zZWxlY3QuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQWMsWUFBWSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUE0QixTQUFTLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6TSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7OztBQWlCL0MsTUFBTSxPQUFPLG9CQUFvQjtJQWZqQztRQWdCVyxTQUFJLEdBQVUsRUFBRSxDQUFDO1FBR2pCLFdBQU0sR0FBVyxrQkFBa0IsQ0FBQztRQUNwQyxjQUFTLEdBQVcsZUFBZSxDQUFDO1FBQ3BDLGVBQVUsR0FBVyxPQUFPLENBQUM7UUFDN0IsaUJBQVksR0FBWSxFQUFFLENBQUM7UUFDM0IsaUJBQVksR0FBWSxHQUFHLENBQUM7UUFDNUIsYUFBUSxHQUFhLEtBQUssQ0FBQztRQUMzQixxQkFBZ0IsR0FBYSxJQUFJLENBQUM7UUFDbEMsV0FBTSxHQUFXLE1BQU0sQ0FBQztRQUNiLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBTS9DLGFBQVEsR0FBRyxDQUFDLEtBQVUsRUFBRSxFQUFFLEdBQUUsQ0FBQyxDQUFDO1FBQzlCLGNBQVMsR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFOUIsaUJBQVksR0FBRyxNQUFNLENBQVEsRUFBRSxDQUFDLENBQUM7UUFDakMsaUJBQVksR0FBRyxNQUFNLENBQU0sRUFBRSxDQUFDLENBQUM7UUFDL0Isa0JBQWEsR0FBRyxNQUFNLENBQVEsRUFBRSxDQUFDLENBQUM7UUFDbEMsV0FBTSxHQUFHLE1BQU0sQ0FBVSxLQUFLLENBQUMsQ0FBQztLQXdRakM7SUFyUUMsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUU3RCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVELGtCQUFrQjtRQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2xDLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN4QyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBQzdDLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSztvQkFDbkIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxTQUFTO2lCQUN4QixDQUFDLENBQUMsQ0FBQztnQkFDSixJQUFJLENBQUMsSUFBSSxHQUFHLFVBQVUsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2dCQUM3RCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFBO2dCQUNwQixJQUFJLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQztnQkFDckIsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7WUFDakMsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHVCQUF1QjtRQUNyQixJQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFDLENBQUM7WUFDNUMsSUFBRyxJQUFJLENBQUMsUUFBUSxFQUFDLENBQUM7Z0JBQ2hCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN4QixJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDM0IsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDO2dCQUNoQixLQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUMsQ0FBQztvQkFDbEMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO29CQUNwRCxDQUFDLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztvQkFFcEIsTUFBTSxJQUFJLEdBQUc7d0JBQ1gsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7d0JBQzNCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUc7cUJBQ2xCLENBQUM7b0JBRUYsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbEIsQ0FBQztnQkFDRCxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDN0IsSUFBSSxDQUFDLFlBQVksR0FBRyxTQUFTLENBQUM7WUFDaEMsQ0FBQztpQkFBSSxDQUFDO2dCQUNKLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ3BFLElBQUcsR0FBRyxFQUFDLENBQUM7b0JBQ04sSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7b0JBQ3hCLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUMsQ0FBQztvQkFDcEYsR0FBRyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7b0JBQ3RCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO29CQUN0RSxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsQ0FBQztvQkFDOUIsSUFBRyxTQUFTLEVBQUMsQ0FBQzt3QkFDWixTQUFTLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztvQkFDOUIsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztRQUVILENBQUM7SUFDSCxDQUFDO0lBRUQsWUFBWTtRQUNWLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxnQkFBaUIsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFGLElBQUksT0FBTyxHQUFHLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM3SCxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQzVHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUM7SUFDOUMsQ0FBQztJQUVELFFBQVEsQ0FBQyxLQUFVO1FBQ2pCLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFFN0IsSUFBSSxPQUFPLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxTQUFTLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDbkQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RCLENBQUM7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCO1FBQ2QsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNoQyxHQUFHLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxjQUFjO1FBQ1osSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3JDLE9BQU87UUFDVCxDQUFDO1FBQ0QsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7SUFDM0MsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBRWhDLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUM7WUFDbEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQy9DLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNWLENBQUM7SUFDSCxDQUFDO0lBR0QsV0FBVyxDQUFDLEtBQWlCO1FBQzNCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFxQixDQUFDO1FBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7WUFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLGdCQUFpQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUYsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2xJLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hDLElBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFDLENBQUM7WUFDakIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3hCLENBQUM7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLElBQVM7UUFDbEIsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyw4QkFBOEIsQ0FBQTtRQUN2QyxDQUFDO1FBRUQsT0FBTyxpQkFBaUIsQ0FBQTtJQUMxQixDQUFDO0lBRUQsU0FBUyxDQUFDLEtBQW9CO1FBQzVCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFNUUsSUFBSSxLQUFLLENBQUMsR0FBRyxLQUFLLE9BQU8sRUFBRSxDQUFDO1lBQzFCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN2QixJQUFJLFlBQVksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pELENBQUM7UUFDSCxDQUFDO2FBQU0sSUFBSSxLQUFLLENBQUMsR0FBRyxLQUFLLFdBQVcsRUFBRSxDQUFDO1lBQ3JDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN2QixJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNsRCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO2dCQUN4RCxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN6QyxDQUFDO1FBQ0gsQ0FBQzthQUFNLElBQUksS0FBSyxDQUFDLEdBQUcsS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNuQyxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDdkIsSUFBSSxZQUFZLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN4QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7Z0JBQ3hELElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUVELGVBQWUsQ0FBQyxLQUFhO1FBQzNCLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQWdCLENBQUM7UUFDNUUsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQWdCLENBQUM7UUFDM0QsU0FBUyxDQUFDLGNBQWMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELGlCQUFpQixDQUFDLElBQVM7UUFDeEIsTUFBTSxZQUFZLEdBQUc7WUFDcEIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDOUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7U0FDL0IsQ0FBQztRQUVGLElBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUMsQ0FBQztZQUNwQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUMxQixDQUFDO1FBR0QsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRTVILElBQUksYUFBYSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDckIsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzdCLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztnQkFDL0IsWUFBWSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLE9BQU8sWUFBWSxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQzthQUFNLENBQUM7WUFDSixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztZQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUMvRCxDQUFDO1FBRUQsSUFBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUMsQ0FBQztZQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QixDQUFDO1FBRUQsTUFBTSx1QkFBdUIsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2pGLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBRXZDLElBQUksQ0FBQyxnQkFBaUIsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEQsQ0FBQztJQUVELFlBQVksQ0FBQyxJQUFRO1FBQ25CLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLElBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekIsQ0FBQztRQUNELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsZ0JBQWlCLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2hELENBQUM7SUFFRCxNQUFNLENBQUMsSUFBUztRQUNkLElBQUcsSUFBSSxDQUFDLFFBQVEsRUFBQyxDQUFDO1lBQ2hCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixDQUFDO2FBQUksQ0FBQztZQUNKLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUIsQ0FBQztJQUNILENBQUM7SUFFRCxZQUFZLENBQUMsTUFBNEI7UUFDdkMsTUFBTSxZQUFZLEdBQUc7WUFDbkIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUs7WUFDMUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsTUFBTSxDQUFDLFNBQVM7U0FDL0IsQ0FBQztRQUNGLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVELFVBQVUsQ0FBQyxLQUFVO1FBQ25CLElBQUcsS0FBSyxFQUFDLENBQUM7WUFDUixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztZQUMxQixJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztRQUNqQyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN4QixDQUFDO0lBQ0gsQ0FBQztJQUVELGdCQUFnQixDQUFDLEVBQU87UUFDdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVELGlCQUFpQixDQUFDLEVBQU87UUFDdkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVELGdCQUFnQixDQUFDLFVBQW1CO1FBQ2xDLHNCQUFzQjtJQUN4QixDQUFDO0lBRUQsbUNBQW1DLENBQUMsS0FBYSxFQUFFLElBQVM7UUFDMUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDL0IsTUFBTSxZQUFZLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQy9CLFlBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE9BQU8sWUFBWSxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBRUQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUM3RSxJQUFHLFlBQVksRUFBQyxDQUFDO1lBQ2YsWUFBWSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDbEMsQ0FBQztRQUdELE1BQU0sdUJBQXVCLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNqRixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxRQUFRLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUV2QyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN4QixDQUFDOzhHQS9SVSxvQkFBb0I7a0dBQXBCLG9CQUFvQix3YUFScEI7WUFDVDtnQkFDRSxPQUFPLEVBQUUsaUJBQWlCO2dCQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLG9CQUFvQixDQUFDO2dCQUNuRCxLQUFLLEVBQUUsSUFBSTthQUNaO1NBQ0Ysc0VBZ0JpQyxvQkFBb0IseUtDbEN4RCx1N0RBcUNNLHUwRkQ3Qk0sWUFBWTs7MkZBWVgsb0JBQW9CO2tCQWZoQyxTQUFTOytCQUNFLGNBQWMsY0FDWixJQUFJLFdBQ1AsQ0FBQyxZQUFZLENBQUMsaUJBR1IsaUJBQWlCLENBQUMsSUFBSSxhQUMxQjt3QkFDVDs0QkFDRSxPQUFPLEVBQUUsaUJBQWlCOzRCQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxxQkFBcUIsQ0FBQzs0QkFDbkQsS0FBSyxFQUFFLElBQUk7eUJBQ1o7cUJBQ0Y7OEJBR1EsSUFBSTtzQkFBWixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxnQkFBZ0I7c0JBQXhCLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNjLFFBQVE7c0JBQTNCLE1BQU07dUJBQUMsVUFBVTtnQkFFdUMsT0FBTztzQkFBL0QsZUFBZTt1QkFBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsb0JBQW9CLENBQUM7Z0JBRXhCLGdCQUFnQjtzQkFBOUMsU0FBUzt1QkFBQyxrQkFBa0I7Z0JBZ0g3QixXQUFXO3NCQURWLFlBQVk7dUJBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkNoYW5nZXMsIE91dHB1dCwgUXVlcnlMaXN0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIFZpZXdFbmNhcHN1bGF0aW9uLCBmb3J3YXJkUmVmLCBzaWduYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEZsZXhpT3B0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi9mbGV4aS1vcHRpb24uY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnZmxleGktc2VsZWN0JyxcclxuICBzdGFuZGFsb25lOiB0cnVlLFxyXG4gIGltcG9ydHM6IFtDb21tb25Nb2R1bGVdLFxyXG4gIHRlbXBsYXRlVXJsOiBcIi4vZmxleGktc2VsZWN0LmNvbXBvbmVudC5odG1sXCIsXHJcbiAgc3R5bGVVcmw6IFwiLi9mbGV4aS1zZWxlY3QuY29tcG9uZW50LmNzc1wiLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICB7XHJcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGbGV4aVNlbGVjdENvbXBvbmVudCksXHJcbiAgICAgIG11bHRpOiB0cnVlXHJcbiAgICB9XHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRmxleGlTZWxlY3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgpIGRhdGE6IGFueVtdID0gW107XHJcbiAgQElucHV0KCkgdmFsdWU6IGFueTtcclxuICBASW5wdXQoKSBsYWJlbDogYW55O1xyXG4gIEBJbnB1dCgpIG5vRGF0YTogc3RyaW5nID0gXCJLYXnEsXQgYnVsdW5hbWFkxLFcIjtcclxuICBASW5wdXQoKSBzZWxlY3RPbmU6IHN0cmluZyA9IFwiU2XDp2ltIHlhcMSxbsSxelwiO1xyXG4gIEBJbnB1dCgpIHRoZW1lQ2xhc3M6IHN0cmluZyA9IFwibGlnaHRcIjtcclxuICBASW5wdXQoKSBpdGVtc1BlclBhZ2UgOiBudW1iZXIgPSAzMDtcclxuICBASW5wdXQoKSBjbGllbnRIZWlnaHQgOiBudW1iZXIgPSAxODA7XHJcbiAgQElucHV0KCkgbXVsdGlwbGUgOiBib29sZWFuID0gZmFsc2U7XHJcbiAgQElucHV0KCkgY2xvc2VBZnRlclNlbGVjdCA6IGJvb2xlYW4gPSB0cnVlO1xyXG4gIEBJbnB1dCgpIGhlaWdodDogc3RyaW5nID0gXCIxMDAlXCI7XHJcbiAgQE91dHB1dChcInNlbGVjdGVkXCIpIHNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7ICBcclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihmb3J3YXJkUmVmKCgpID0+IEZsZXhpT3B0aW9uQ29tcG9uZW50KSkgb3B0aW9ucyE6IFF1ZXJ5TGlzdDxGbGV4aU9wdGlvbkNvbXBvbmVudD47XHJcblxyXG4gIEBWaWV3Q2hpbGQoXCJmbGV4aVNlbGVjdElucHV0XCIpIGZsZXhpU2VsZWN0SW5wdXQ6IEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudD4gfCB1bmRlZmluZWQ7XHJcblxyXG4gIHByaXZhdGUgb25DaGFuZ2UgPSAodmFsdWU6IGFueSkgPT4ge307XHJcbiAgcHJpdmF0ZSBvblRvdWNoZWQgPSAoKSA9PiB7IH07XHJcblxyXG4gIGZpbHRlcmVkRGF0YSA9IHNpZ25hbDxhbnlbXT4oW10pO1xyXG4gIHNlbGVjdGVkSXRlbSA9IHNpZ25hbDxhbnk+KHt9KTtcclxuICBzZWxlY3RlZEl0ZW1zID0gc2lnbmFsPGFueVtdPihbXSk7XHJcbiAgaXNPcGVuID0gc2lnbmFsPGJvb2xlYW4+KGZhbHNlKTtcclxuICBpbml0aWFsU3RhdGUgOiBhbnk7XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHsgICAgXHJcbiAgICB0aGlzLmZpbHRlcmVkRGF0YS5zZXQodGhpcy5kYXRhLnNsaWNlKDAsIHRoaXMuaXRlbXNQZXJQYWdlKSk7ICAgIFxyXG4gICAgXHJcbiAgICB0aGlzLnNlbGVjdEZpcnN0T25lKCk7XHJcbiAgICB0aGlzLnNlbGVjdEluaXRpYWxTdGF0ZVZhbHVlKCk7ICBcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcclxuICAgIHRoaXMub3B0aW9ucy5jaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbkRhdGEgPSB0aGlzLm9wdGlvbnMubWFwKG9wdGlvbiA9PiAoe1xyXG4gICAgICAgICAgdmFsdWU6IG9wdGlvbi52YWx1ZSxcclxuICAgICAgICAgIGxhYmVsOiBvcHRpb24udmlld1ZhbHVlXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IG9wdGlvbkRhdGE7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJlZERhdGEuc2V0KHRoaXMuZGF0YS5zbGljZSgwLCB0aGlzLml0ZW1zUGVyUGFnZSkpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0Rmlyc3RPbmUoKTtcclxuICAgICAgICB0aGlzLmxhYmVsID0gXCJsYWJlbFwiXHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IFwidmFsdWVcIjtcclxuICAgICAgICB0aGlzLnNlbGVjdEluaXRpYWxTdGF0ZVZhbHVlKCk7ICAgICAgICBcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RJbml0aWFsU3RhdGVWYWx1ZSgpe1xyXG4gICAgaWYodGhpcy5kYXRhLmxlbmd0aCA+IDAgJiYgdGhpcy5pbml0aWFsU3RhdGUpeyAgICAgIFxyXG4gICAgICBpZih0aGlzLm11bHRpcGxlKXtcclxuICAgICAgICB0aGlzLmNsZWFyQWxsU2VsZWN0ZWQoKTsgICAgICAgIFxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5zZXQoW10pO1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSBbXTtcclxuICAgICAgICBmb3IoY29uc3QgdmFsIG9mIHRoaXMuaW5pdGlhbFN0YXRlKXtcclxuICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLmRhdGEuZmluZChwPT4gcFt0aGlzLnZhbHVlXSA9PT0gdmFsKTtcclxuICAgICAgICAgIGQuaXNTZWxlY3RlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgY29uc3QgaXRlbSA9IHtcclxuICAgICAgICAgICAgW3RoaXMubGFiZWxdOiBkW3RoaXMubGFiZWxdLFxyXG4gICAgICAgICAgICBbdGhpcy52YWx1ZV06IHZhbFxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBsaXN0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5zZXQobGlzdCk7ICAgICAgICBcclxuICAgICAgICB0aGlzLmluaXRpYWxTdGF0ZSA9IHVuZGVmaW5lZDtcclxuICAgICAgfWVsc2V7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5kYXRhLmZpbmQocD0+IHBbdGhpcy52YWx1ZV0gPT09IHRoaXMuaW5pdGlhbFN0YXRlKTtcclxuICAgICAgICBpZih2YWwpe1xyXG4gICAgICAgICAgdGhpcy5jbGVhckFsbFNlbGVjdGVkKCk7ICAgICAgICBcclxuICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtLnNldCh7W3RoaXMubGFiZWxdOnZhbFt0aGlzLmxhYmVsXSwgW3RoaXMudmFsdWVdOnZhbFt0aGlzLnZhbHVlXX0pO1xyXG4gICAgICAgICAgdmFsLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgY29uc3QgZmluZFZhbHVlID0gdGhpcy5maWx0ZXJlZERhdGEoKS5maW5kKHA9PiBwW3RoaXMudmFsdWVdID09PSB2YWwpO1xyXG4gICAgICAgICAgdGhpcy5pbml0aWFsU3RhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBpZihmaW5kVmFsdWUpe1xyXG4gICAgICAgICAgICBmaW5kVmFsdWUuaXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbG9hZE1vcmVEYXRhKCkge1xyXG4gICAgY29uc3QgdmFsID0gdGhpcy5mbGV4aVNlbGVjdElucHV0IS5uYXRpdmVFbGVtZW50LnZhbHVlLnRvU3RyaW5nKCkudG9Mb2NhbGVMb3dlckNhc2UoXCJ0clwiKTtcclxuICAgIGxldCBuZXdEYXRhID0gdmFsID09PSBcIlwiID8gdGhpcy5kYXRhIDogdGhpcy5kYXRhLmZpbHRlcihwID0+IHBbdGhpcy5sYWJlbF0udG9TdHJpbmcoKS50b0xvY2FsZUxvd2VyQ2FzZShcInRyXCIpLmluY2x1ZGVzKHZhbCkpO1xyXG4gICAgbmV3RGF0YSA9IG5ld0RhdGEuc2xpY2UoKHRoaXMuZmlsdGVyZWREYXRhKCkubGVuZ3RoIC0gMSksICh0aGlzLmZpbHRlcmVkRGF0YSgpLmxlbmd0aCArIHRoaXMuaXRlbXNQZXJQYWdlKSk7XHJcbiAgICB0aGlzLmZpbHRlcmVkRGF0YS5zZXQoWy4uLnRoaXMuZmlsdGVyZWREYXRhKCksIC4uLm5ld0RhdGFdKTtcclxuICAgIHRoaXMuY2xpZW50SGVpZ2h0ID0gdGhpcy5jbGllbnRIZWlnaHQgKyAxODA7XHJcbiAgfVxyXG5cclxuICBvblNjcm9sbChldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cclxuICAgIGlmIChlbGVtZW50LnNjcm9sbEhlaWdodCAtIGVsZW1lbnQuc2Nyb2xsVG9wIDwgMjAwKSB7XHJcbiAgICAgIHRoaXMubG9hZE1vcmVEYXRhKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGVhckFsbFNlbGVjdGVkKCkge1xyXG4gICAgdGhpcy5maWx0ZXJlZERhdGEoKS5mb3JFYWNoKHZhbCA9PiB7XHJcbiAgICAgIHZhbC5pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlbGVjdEZpcnN0T25lKCkge1xyXG4gICAgaWYgKHRoaXMuZmlsdGVyZWREYXRhKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY2xlYXJBbGxTZWxlY3RlZCgpO1xyXG4gICAgdGhpcy5maWx0ZXJlZERhdGEoKVswXS5pc1NlbGVjdGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIG9wZW5PckNsb3NlKCkge1xyXG4gICAgdGhpcy5pc09wZW4uc2V0KCF0aGlzLmlzT3BlbigpKTsgXHJcblxyXG4gICAgaWYgKHRoaXMuaXNPcGVuKCkpIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5mbGV4aVNlbGVjdElucHV0Py5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgIH0sIDEwMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDpjbGljaycsIFsnJGV2ZW50J10pXHJcbiAgaGFuZGxlQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcclxuICAgIGlmICghdGFyZ2V0LmNsb3Nlc3QoJy5mbGV4aS1zZWxlY3QnKSkge1xyXG4gICAgICB0aGlzLmlzT3Blbi5zZXQoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VhcmNoKCkge1xyXG4gICAgY29uc3QgdmFsID0gdGhpcy5mbGV4aVNlbGVjdElucHV0IS5uYXRpdmVFbGVtZW50LnZhbHVlLnRvU3RyaW5nKCkudG9Mb2NhbGVMb3dlckNhc2UoXCJ0clwiKTsgXHJcbiAgICBjb25zdCBmaWx0ZXJlZCA9IHRoaXMuZGF0YS5maWx0ZXIocCA9PiBwW3RoaXMubGFiZWxdLnRvU3RyaW5nKCkudG9Mb2NhbGVMb3dlckNhc2UoXCJ0clwiKS5pbmNsdWRlcyh2YWwpKS5zbGljZSgwLHRoaXMuaXRlbXNQZXJQYWdlKTtcclxuICAgIHRoaXMuZmlsdGVyZWREYXRhLnNldChmaWx0ZXJlZCk7XHJcbiAgICBpZighdGhpcy5tdWx0aXBsZSl7XHJcbiAgICAgIHRoaXMuc2VsZWN0Rmlyc3RPbmUoKTtcclxuICAgIH0gICAgXHJcbiAgfVxyXG5cclxuICBzZXRMaUNsYXNzKGl0ZW06IGFueSkge1xyXG4gICAgaWYgKGl0ZW0uaXNTZWxlY3RlZCkge1xyXG4gICAgICByZXR1cm4gXCJmbGV4aS1zZWxlY3QtbGkgZmxleGktYWN0aXZlXCJcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gXCJmbGV4aS1zZWxlY3QtbGlcIlxyXG4gIH1cclxuXHJcbiAgb25LZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XHJcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmZpbHRlcmVkRGF0YSgpLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaXNTZWxlY3RlZCk7XHJcblxyXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBpZiAoY3VycmVudEluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0KHRoaXMuZmlsdGVyZWREYXRhKClbY3VycmVudEluZGV4XSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAnQXJyb3dEb3duJykge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBpZiAoY3VycmVudEluZGV4IDwgdGhpcy5maWx0ZXJlZERhdGEoKS5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhckFsbFNlbGVjdGVkKCk7ICAgICAgICBcclxuICAgICAgICB0aGlzLmZpbHRlcmVkRGF0YSgpW2N1cnJlbnRJbmRleCArIDFdLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2Nyb2xsVG9FbGVtZW50KGN1cnJlbnRJbmRleCArIDEpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93VXAnKSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGlmIChjdXJyZW50SW5kZXggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhckFsbFNlbGVjdGVkKCk7ICAgICAgICBcclxuICAgICAgICB0aGlzLmZpbHRlcmVkRGF0YSgpW2N1cnJlbnRJbmRleCAtIDFdLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2Nyb2xsVG9FbGVtZW50KGN1cnJlbnRJbmRleCAtIDEpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzY3JvbGxUb0VsZW1lbnQoaW5kZXg6IG51bWJlcikge1xyXG4gICAgY29uc3QgdWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZsZXhpLXNlbGVjdC11bCcpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgY29uc3QgbGlFbGVtZW50ID0gdWxFbGVtZW50LmNoaWxkcmVuW2luZGV4XSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGxpRWxlbWVudC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICduZWFyZXN0JyB9KTtcclxuICB9XHJcblxyXG4gIHNlbGVjdEZvck11bHRpcGxlKGl0ZW06IGFueSkgeyAgICAgXHJcbiAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtID0ge1xyXG4gICAgICBbdGhpcy5sYWJlbF06IGl0ZW1bdGhpcy5sYWJlbF0sXHJcbiAgICAgIFt0aGlzLnZhbHVlXTogaXRlbVt0aGlzLnZhbHVlXVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zKCkubGVuZ3RoID09PSAwKXtcclxuICAgICAgdGhpcy5jbGVhckFsbFNlbGVjdGVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICBjb25zdCBleGlzdGluZ0luZGV4ID0gdGhpcy5zZWxlY3RlZEl0ZW1zKCkuZmluZEluZGV4KGV4aXN0aW5nSXRlbSA9PiBleGlzdGluZ0l0ZW1bdGhpcy52YWx1ZV0gPT09IHNlbGVjdGVkSXRlbVt0aGlzLnZhbHVlXSk7XHJcblxyXG4gICAgaWYgKGV4aXN0aW5nSW5kZXggPiAtMSkgeyAgICAgICAgXHJcbiAgICAgICAgaXRlbS5pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnVwZGF0ZShwcmV2ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEl0ZW1zID0gWy4uLnByZXZdO1xyXG4gICAgICAgICAgICB1cGRhdGVkSXRlbXMuc3BsaWNlKGV4aXN0aW5nSW5kZXgsIDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlZEl0ZW1zO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHsgICAgICAgIFxyXG4gICAgICAgIGl0ZW0uaXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnVwZGF0ZShwcmV2ID0+IFsuLi5wcmV2LCBzZWxlY3RlZEl0ZW1dKTtcclxuICAgIH0gICAgXHJcbiAgICBcclxuICAgIGlmKHRoaXMuY2xvc2VBZnRlclNlbGVjdCl7XHJcbiAgICAgIHRoaXMuaXNPcGVuLnNldChmYWxzZSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IHNlbGVjdGVkSXRlbXNGb3JOZ01vZGVsID0gdGhpcy5zZWxlY3RlZEl0ZW1zKCkubWFwKHZhbCA9PiB2YWxbdGhpcy52YWx1ZV0pO1xyXG4gICAgdGhpcy5zZWxlY3RlZC5lbWl0KHNlbGVjdGVkSXRlbXNGb3JOZ01vZGVsKTtcclxuICAgIHRoaXMub25DaGFuZ2Uoc2VsZWN0ZWRJdGVtc0Zvck5nTW9kZWwpO1xyXG4gICAgXHJcbiAgICB0aGlzLmZsZXhpU2VsZWN0SW5wdXQhLm5hdGl2ZUVsZW1lbnQuc2VsZWN0KCk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RTaW5nbGUoaXRlbTphbnkpe1xyXG4gICAgdGhpcy5jbGVhckFsbFNlbGVjdGVkKCk7XHJcbiAgICBpdGVtLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgdGhpcy5zZWxlY3RlZEl0ZW0uc2V0KGl0ZW0pO1xyXG4gICAgaWYodGhpcy5jbG9zZUFmdGVyU2VsZWN0KXtcclxuICAgICAgdGhpcy5pc09wZW4uc2V0KGZhbHNlKTtcclxuICAgIH1cclxuICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChpdGVtW3RoaXMudmFsdWVdKTtcclxuICAgIHRoaXMub25DaGFuZ2UoaXRlbVt0aGlzLnZhbHVlXSk7XHJcbiAgICB0aGlzLmZsZXhpU2VsZWN0SW5wdXQhLm5hdGl2ZUVsZW1lbnQuc2VsZWN0KCk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3QoaXRlbTogYW55KSB7XHJcbiAgICBpZih0aGlzLm11bHRpcGxlKXtcclxuICAgICAgdGhpcy5zZWxlY3RGb3JNdWx0aXBsZShpdGVtKTtcclxuICAgIH1lbHNle1xyXG4gICAgICB0aGlzLnNlbGVjdFNpbmdsZShpdGVtKTtcclxuICAgIH0gICAgXHJcbiAgfVxyXG5cclxuICBzZWxlY3RPcHRpb24ob3B0aW9uOiBGbGV4aU9wdGlvbkNvbXBvbmVudCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRJdGVtID0ge1xyXG4gICAgICBbdGhpcy52YWx1ZV06IG9wdGlvbi52YWx1ZSxcclxuICAgICAgW3RoaXMubGFiZWxdOiBvcHRpb24udmlld1ZhbHVlXHJcbiAgICB9O1xyXG4gICAgdGhpcy5zZWxlY3Qoc2VsZWN0ZWRJdGVtKTtcclxuICB9XHJcblxyXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQgeyAgICBcclxuICAgIGlmKHZhbHVlKXtcclxuICAgICAgdGhpcy5pbml0aWFsU3RhdGUgPSB2YWx1ZTtcclxuICAgICAgdGhpcy5zZWxlY3RJbml0aWFsU3RhdGVWYWx1ZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZEl0ZW0uc2V0KHt9KTtcclxuICAgICAgdGhpcy5zZWxlY3RGaXJzdE9uZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uVG91Y2hlZCA9IGZuO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAvLyBJbXBsZW1lbnQgaWYgbmVlZGVkXHJcbiAgfVxyXG5cclxuICByZW1vdmVTZWxlY3RlZEl0ZW1Gcm9tU2VsZWN0ZWRJdGVtcyhpbmRleDogbnVtYmVyLCBpdGVtOiBhbnkpeyAgICBcclxuICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy51cGRhdGUocHJldiA9PiB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRJdGVtcyA9IFsuLi5wcmV2XTtcclxuICAgICAgdXBkYXRlZEl0ZW1zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIHJldHVybiB1cGRhdGVkSXRlbXM7XHJcbiAgfSk7XHJcblxyXG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gdGhpcy5kYXRhLmZpbmQocCA9PiBwW3RoaXMudmFsdWVdID09PSBpdGVtW3RoaXMudmFsdWVdKTtcclxuICAgIGlmKGV4aXN0aW5nSXRlbSl7XHJcbiAgICAgIGV4aXN0aW5nSXRlbS5pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnN0IHNlbGVjdGVkSXRlbXNGb3JOZ01vZGVsID0gdGhpcy5zZWxlY3RlZEl0ZW1zKCkubWFwKHZhbCA9PiB2YWxbdGhpcy52YWx1ZV0pO1xyXG4gICAgdGhpcy5zZWxlY3RlZC5lbWl0KHNlbGVjdGVkSXRlbXNGb3JOZ01vZGVsKTtcclxuICAgIHRoaXMub25DaGFuZ2Uoc2VsZWN0ZWRJdGVtc0Zvck5nTW9kZWwpO1xyXG4gICAgXHJcbiAgICB0aGlzLmlzT3Blbi5zZXQodHJ1ZSk7XHJcbiAgfVxyXG59XHJcbiIsIjxkaXYgY2xhc3M9XCJmbGV4aS1zZWxlY3RcIiBbYXR0ci5kYXRhLWJzLXRoZW1lXT1cInRoZW1lQ2xhc3NcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJmbGV4aS1zZWxlY3QtZGl2XCIgKGNsaWNrKT1cIm9wZW5PckNsb3NlKClcIiBbbmdTdHlsZV09XCJ7J2hlaWdodCc6IGhlaWdodH1cIj5cclxuICAgICAgICBAaWYoIW11bHRpcGxlKXtcclxuICAgICAgICAgICAgPHNwYW4+XHJcbiAgICAgICAgICAgICAgICB7e3NlbGVjdGVkSXRlbSgpW2xhYmVsXSA9PT0gdW5kZWZpbmVkID8gc2VsZWN0T25lIDogc2VsZWN0ZWRJdGVtKClbbGFiZWxdfX1cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgIH1AZWxzZSB7XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4aS1zZWxlY3QtbXVsdGlwbGUtY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgICAgICBAZm9yKGl0ZW0gb2Ygc2VsZWN0ZWRJdGVtcygpO3RyYWNrIGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4aS1zZWxlY3QtbXVsdGlwbGUtdmFsdWVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gYXJpYS1oaWRkZW49XCJ0cnVlXCIgY2xhc3M9XCJmbGV4aS1zZWxlY3QtbXVsdGlwbGUtdmFsdWUtaWNvbi1sZWZ0XCIgKGNsaWNrKT1cInJlbW92ZVNlbGVjdGVkSXRlbUZyb21TZWxlY3RlZEl0ZW1zKCRpbmRleCwgaXRlbSlcIj7Dlzwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmbGV4aS1zZWxlY3QtbXVsdGlwbGUtdmFsdWUtbGFiZWxcIj57e2l0ZW1bbGFiZWxdfX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIH1cclxuICAgICAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2aWV3Qm94PVwiMCAwIDMyMCA1MTJcIiBjbGFzcz1cImZsZXhpLXNlbGVjdC1kaXYtc3ZnXCI+XHJcbiAgICAgICAgICAgIDxwYXRoXHJcbiAgICAgICAgICAgICAgICBkPVwiTTE4Mi42IDQ3MC42Yy0xMi41IDEyLjUtMzIuOCAxMi41LTQ1LjMgMGwtMTI4LTEyOGMtOS4yLTkuMi0xMS45LTIyLjktNi45LTM0LjlzMTYuNi0xOS44IDI5LjYtMTkuOEgyODhjMTIuOSAwIDI0LjYgNy44IDI5LjYgMTkuOHMyLjIgMjUuNy02LjkgMzQuOWwtMTI4IDEyOHpcIiAvPlxyXG4gICAgICAgIDwvc3ZnPlxyXG4gICAgPC9kaXY+XHJcbiAgICA8ZGl2IGNsYXNzPVwiZmxleGktc2VsZWN0LWRyb3Bkb3duXCIgW2hpZGRlbl09XCIhaXNPcGVuKClcIj5cclxuICAgICAgICA8aW5wdXQgI2ZsZXhpU2VsZWN0SW5wdXQgY2xhc3M9XCJmbGV4aS1zZWxlY3Qtc2VhcmNoLWlucHV0XCIgKGlucHV0KT1cInNlYXJjaCgpXCIgKGtleWRvd24pPVwib25LZXlEb3duKCRldmVudClcIlxyXG4gICAgICAgICAgICB0eXBlPVwic2VhcmNoXCI+XHJcbiAgICAgICAgPHVsIGNsYXNzPVwiZmxleGktc2VsZWN0LXVsXCIgKHNjcm9sbCk9XCJvblNjcm9sbCgkZXZlbnQpXCI+XHJcbiAgICAgICAgICAgIEBmb3IoaXRlbSBvZiBmaWx0ZXJlZERhdGEoKTsgdHJhY2sgJGluZGV4KXsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICA8bGkgKGNsaWNrKT1cInNlbGVjdChpdGVtKVwiIFtjbGFzc109XCJzZXRMaUNsYXNzKGl0ZW0pXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4+e3tpdGVtW2xhYmVsXX19PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPC9saT5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBAZW1wdHkge1xyXG4gICAgICAgICAgICA8bGk+XHJcbiAgICAgICAgICAgICAgICA8c3Bhbj57e25vRGF0YX19PC9zcGFuPlxyXG4gICAgICAgICAgICA8L2xpPlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgPC91bD5cclxuICAgIDwvZGl2PlxyXG48L2Rpdj4iXX0=