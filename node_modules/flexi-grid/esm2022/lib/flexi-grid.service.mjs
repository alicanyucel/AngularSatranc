import { Injectable } from "@angular/core";
import * as i0 from "@angular/core";
export class FlexiGridService {
    getODataEndpoint(state) {
        let endpoint = `$top=${state.pageSize}&$skip=${state.skip}`;
        if (state.sort.field !== '') {
            endpoint += `&$orderby=${this.toTitleCase(state.sort.field)}`;
            if (state.sort.dir === 'desc') {
                endpoint += ` desc`;
            }
        }
        if (state.filter.length > 0) {
            const filters = state.filter.filter(p => p.value);
            if (filters.length > 0) {
                endpoint += `&$filter=`;
                let filterValue = "";
                filters.forEach((val) => {
                    if (filterValue !== "") {
                        filterValue = filterValue + " and ";
                    }
                    if (val.type === "date") {
                        const date = new Date(val.value);
                        const isoDate = date.toISOString().split('T')[0];
                        filterValue += `${this.toTitleCase(val.field)} eq ${isoDate}`;
                    }
                    else if (val.type === "date-time") {
                        const date = new Date(val.value);
                        const isoDate = date.toISOString();
                        filterValue += `${this.toTitleCase(val.field)} eq ${isoDate}`;
                    }
                    else if (val.type === "number") {
                        if (val.operator === "contains")
                            val.operator = "eq";
                        filterValue += `${this.toTitleCase(val.field)} ${val.operator} ${val.value}`;
                    }
                    else if (val.type === "text") {
                        switch (val.operator) {
                            case "contains":
                                filterValue += `contains(${this.toTitleCase(val.field)}, '${val.value}')`;
                                break;
                            case "not contains":
                                filterValue += `not(contains(${this.toTitleCase(val.field)}, '${val.value}'))`;
                                break;
                            case "startswith":
                                filterValue += `startswith(${this.toTitleCase(val.field)}, '${val.value}')`;
                                break;
                            case "endswith":
                                filterValue += `endswith(${this.toTitleCase(val.field)}, '${val.value}')`;
                                break;
                            case "eq":
                            case "ne":
                                filterValue += `${this.toTitleCase(val.field)} ${val.operator} '${val.value}'`;
                                break;
                            default:
                                filterValue += `${this.toTitleCase(val.field)} ${val.operator} '${val.value}'`;
                                break;
                        }
                    }
                });
                endpoint += filterValue;
            }
        }
        return endpoint;
    }
    toTitleCase(str) {
        return str
            .split(' ') // Metni boşluklardan ayırarak kelimelere bölüyoruz.
            .map(word => word.charAt(0).toUpperCase() + word.slice(1)) // Her kelimenin ilk harfini büyük yapıyoruz.
            .join(' '); // Kelimeleri tekrar birleştiriyoruz.
    }
    exportDataToExcel(data, fileName) {
        if (data.length === 0) {
            console.error('No data to export');
            return;
        }
        // Sütun başlıklarını elde et
        const headers = Object.keys(data[0]);
        // CSV string oluşturma
        let csvData = headers.join(',') + '\n';
        data.forEach(row => {
            let rowData = headers.map(header => {
                const cellData = row[header] ? row[header].toString().replace(/"/g, '""') : '';
                return `"${cellData}"`;
            }).join(',');
            csvData += rowData + '\n';
        });
        // CSV dosyasını indirme
        const blob = new Blob([csvData], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('hidden', '');
        a.setAttribute('href', url);
        a.setAttribute('download', fileName + '.csv');
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: FlexiGridService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: FlexiGridService, providedIn: "root" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.6", ngImport: i0, type: FlexiGridService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: "root"
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxleGktZ3JpZC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZmxleGktZ3JpZC9zcmMvbGliL2ZsZXhpLWdyaWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQU0zQyxNQUFNLE9BQU8sZ0JBQWdCO0lBQ3pCLGdCQUFnQixDQUFDLEtBQWlCO1FBQzlCLElBQUksUUFBUSxHQUFHLFFBQVEsS0FBSyxDQUFDLFFBQVEsVUFBVSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFNUQsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUMxQixRQUFRLElBQUksYUFBYSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUM5RCxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLE1BQU0sRUFBRSxDQUFDO2dCQUM1QixRQUFRLElBQUksT0FBTyxDQUFDO1lBQ3hCLENBQUM7UUFDTCxDQUFDO1FBRUQsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUMxQixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVqRCxJQUFHLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3BCLFFBQVEsSUFBSSxXQUFXLENBQUM7Z0JBQ3hCLElBQUksV0FBVyxHQUFXLEVBQUUsQ0FBQztnQkFFN0IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQXFCLEVBQUUsRUFBRTtvQkFFdEMsSUFBSSxXQUFXLEtBQUssRUFBRSxFQUFFLENBQUM7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QUFPLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztRQUVILHdCQUF3QjtRQUN4QixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFDdkQsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0MsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxRQUFRLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDOUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ1YsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDL0IsQ0FBQzs4R0F6R00sZ0JBQWdCO2tIQUFoQixnQkFBZ0IsY0FGYixNQUFNOzsyRkFFVCxnQkFBZ0I7a0JBSDVCLFVBQVU7bUJBQUM7b0JBQ1IsVUFBVSxFQUFFLE1BQU07aUJBQ3JCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFN0YXRlRmlsdGVyTW9kZWwsIFN0YXRlTW9kZWwgfSBmcm9tIFwiLi9zdGF0ZS5tb2RlbFwiO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogXCJyb290XCJcclxufSlcclxuZXhwb3J0IGNsYXNzIEZsZXhpR3JpZFNlcnZpY2Uge1xyXG4gICAgZ2V0T0RhdGFFbmRwb2ludChzdGF0ZTogU3RhdGVNb2RlbCkge1xyXG4gICAgICAgIGxldCBlbmRwb2ludCA9IGAkdG9wPSR7c3RhdGUucGFnZVNpemV9JiRza2lwPSR7c3RhdGUuc2tpcH1gO1xyXG5cclxuICAgICAgICBpZiAoc3RhdGUuc29ydC5maWVsZCAhPT0gJycpIHtcclxuICAgICAgICAgICAgZW5kcG9pbnQgKz0gYCYkb3JkZXJieT0ke3RoaXMudG9UaXRsZUNhc2Uoc3RhdGUuc29ydC5maWVsZCl9YDtcclxuICAgICAgICAgICAgaWYgKHN0YXRlLnNvcnQuZGlyID09PSAnZGVzYycpIHtcclxuICAgICAgICAgICAgICAgIGVuZHBvaW50ICs9IGAgZGVzY2A7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzdGF0ZS5maWx0ZXIubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJzID0gc3RhdGUuZmlsdGVyLmZpbHRlcihwPT4gcC52YWx1ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihmaWx0ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGVuZHBvaW50ICs9IGAmJGZpbHRlcj1gO1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpbHRlclZhbHVlOiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXJzLmZvckVhY2goKHZhbDogU3RhdGVGaWx0ZXJNb2RlbCkgPT4ge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlclZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclZhbHVlID0gZmlsdGVyVmFsdWUgKyBcIiBhbmQgXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbC50eXBlID09PSBcImRhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNvRGF0ZSA9IGRhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSArPSBgJHt0aGlzLnRvVGl0bGVDYXNlKHZhbC5maWVsZCl9IGVxICR7aXNvRGF0ZX1gO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWwudHlwZSA9PT0gXCJkYXRlLXRpbWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNvRGF0ZSA9IGRhdGUudG9JU09TdHJpbmcoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSArPSBgJHt0aGlzLnRvVGl0bGVDYXNlKHZhbC5maWVsZCl9IGVxICR7aXNvRGF0ZX1gO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWwudHlwZSA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsLm9wZXJhdG9yID09PSBcImNvbnRhaW5zXCIpIHZhbC5vcGVyYXRvciA9IFwiZXFcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgKz0gYCR7dGhpcy50b1RpdGxlQ2FzZSh2YWwuZmllbGQpfSAke3ZhbC5vcGVyYXRvcn0gJHt2YWwudmFsdWV9YDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsLnR5cGUgPT09IFwidGV4dFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsLm9wZXJhdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY29udGFpbnNcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSArPSBgY29udGFpbnMoJHt0aGlzLnRvVGl0bGVDYXNlKHZhbC5maWVsZCl9LCAnJHt2YWwudmFsdWV9JylgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm5vdCBjb250YWluc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclZhbHVlICs9IGBub3QoY29udGFpbnMoJHt0aGlzLnRvVGl0bGVDYXNlKHZhbC5maWVsZCl9LCAnJHt2YWwudmFsdWV9JykpYDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFydHN3aXRoXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgKz0gYHN0YXJ0c3dpdGgoJHt0aGlzLnRvVGl0bGVDYXNlKHZhbC5maWVsZCl9LCAnJHt2YWwudmFsdWV9JylgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImVuZHN3aXRoXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgKz0gYGVuZHN3aXRoKCR7dGhpcy50b1RpdGxlQ2FzZSh2YWwuZmllbGQpfSwgJyR7dmFsLnZhbHVlfScpYDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJlcVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm5lXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgKz0gYCR7dGhpcy50b1RpdGxlQ2FzZSh2YWwuZmllbGQpfSAke3ZhbC5vcGVyYXRvcn0gJyR7dmFsLnZhbHVlfSdgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSArPSBgJHt0aGlzLnRvVGl0bGVDYXNlKHZhbC5maWVsZCl9ICR7dmFsLm9wZXJhdG9yfSAnJHt2YWwudmFsdWV9J2A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGVuZHBvaW50ICs9IGZpbHRlclZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZW5kcG9pbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgdG9UaXRsZUNhc2Uoc3RyOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gc3RyXHJcbiAgICAgICAgICAgIC5zcGxpdCgnICcpIC8vIE1ldG5pIGJvxZ9sdWtsYXJkYW4gYXnEsXJhcmFrIGtlbGltZWxlcmUgYsO2bMO8eW9ydXouXHJcbiAgICAgICAgICAgIC5tYXAod29yZCA9PiB3b3JkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKSkgLy8gSGVyIGtlbGltZW5pbiBpbGsgaGFyZmluaSBiw7x5w7xrIHlhcMSxeW9ydXouXHJcbiAgICAgICAgICAgIC5qb2luKCcgJyk7IC8vIEtlbGltZWxlcmkgdGVrcmFyIGJpcmxlxZ90aXJpeW9ydXouXHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0RGF0YVRvRXhjZWwoZGF0YTogYW55W10sIGZpbGVOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGRhdGEgdG8gZXhwb3J0Jyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICBcclxuICAgICAgICAvLyBTw7x0dW4gYmHFn2zEsWtsYXLEsW7EsSBlbGRlIGV0XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IE9iamVjdC5rZXlzKGRhdGFbMF0pO1xyXG4gICAgICBcclxuICAgICAgICAvLyBDU1Ygc3RyaW5nIG9sdcWfdHVybWFcclxuICAgICAgICBsZXQgY3N2RGF0YSA9IGhlYWRlcnMuam9pbignLCcpICsgJ1xcbic7XHJcbiAgICAgICAgZGF0YS5mb3JFYWNoKHJvdyA9PiB7XHJcbiAgICAgICAgICBsZXQgcm93RGF0YSA9IGhlYWRlcnMubWFwKGhlYWRlciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGxEYXRhID0gcm93W2hlYWRlcl0gPyByb3dbaGVhZGVyXS50b1N0cmluZygpLnJlcGxhY2UoL1wiL2csICdcIlwiJykgOiAnJztcclxuICAgICAgICAgICAgcmV0dXJuIGBcIiR7Y2VsbERhdGF9XCJgO1xyXG4gICAgICAgICAgfSkuam9pbignLCcpO1xyXG4gICAgICAgICAgY3N2RGF0YSArPSByb3dEYXRhICsgJ1xcbic7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAgIC8vIENTViBkb3N5YXPEsW7EsSBpbmRpcm1lXHJcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjc3ZEYXRhXSwgeyB0eXBlOiAndGV4dC9jc3YnIH0pO1xyXG4gICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG4gICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgYS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcclxuICAgICAgICBhLnNldEF0dHJpYnV0ZSgnaHJlZicsIHVybCk7XHJcbiAgICAgICAgYS5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZU5hbWUgKyAnLmNzdicpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XHJcbiAgICAgICAgYS5jbGljaygpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7XHJcbiAgICAgIH1cclxufSJdfQ==